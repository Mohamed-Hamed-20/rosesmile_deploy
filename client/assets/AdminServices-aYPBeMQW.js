import{r as o,j as e,z as N,y as j,f as _,h as K,R as B,d as q}from"./index-BzNwyTTe.js";import{A as P}from"./index-Dn6cvt5g.js";import{M as L}from"./minus-lsm2JIKY.js";import{L as F,S as $}from"./sweetalert2.esm.all-Cxdeaupf.js";import{u as G}from"./useAdminService--oL7hFln.js";import{S as H}from"./search-SKB_sI0d.js";import{P as J}from"./plus-BZcG7NK8.js";import{P as Q,T as V}from"./trash-2-Ds3YWRdD.js";import{C as W}from"./chevron-left-tkGkg_Wo.js";const X=({isOpen:S,onClose:w,sections:C,addService:c})=>{const[a,r]=o.useState({title:"",subTitle:"",sectionId:"",image:null,description:[],features:[]}),[x,g]=o.useState(null),[n,f]=o.useState(!1),[b,m]=o.useState(""),[h,p]=o.useState(""),y=(t,i)=>{r({...a,[i]:t.target.value})},I=()=>{b.trim()&&(r({...a,description:[...a.description,b.trim()]}),m(""))},T=()=>{h.trim()&&(r({...a,features:[...a.features,h.trim()]}),p(""))},D=t=>{t.key==="Enter"&&b.trim()&&(t.preventDefault(),I())},E=t=>{t.key==="Enter"&&h.trim()&&(t.preventDefault(),T())},z=t=>{const i=t.target.files[0];i&&(g(URL.createObjectURL(i)),r({...a,image:i}))},s=(t,i)=>{const u=a[t].filter((k,M)=>M!==i);r({...a,[t]:u})},d=async t=>{t.preventDefault(),f(!0);const i=new FormData;i.append("title",a.title),i.append("subTitle",a.subTitle),i.append("sectionId",a.sectionId),a.image&&i.append("image",a.image),a.description.forEach((u,k)=>{u&&i.append(`description[${k}]`,u)}),b.trim()&&i.append(`description[${a.description.length}]`,b.trim()),a.features.forEach((u,k)=>{u&&i.append(`features[${k}]`,u)}),h.trim()&&i.append(`features[${a.features.length}]`,h.trim());try{const u=await c(i);u.success?(j.success(u.message),w(),r({title:"",subTitle:"",sectionId:"",image:null,description:[],features:[]}),g(null),m(""),p("")):j.error(u.message||"حدث خطأ أثناء إضافة الخدمة")}catch(u){j.error(u.message||"حدث خطأ أثناء إضافة الخدمة")}finally{f(!1)}};return S?e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black/60 flex items-center justify-center z-500 p-4",children:e.jsxs(N.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl shadow-2xl w-full h-full max-h-screen overflow-auto p-8 md:p-12",dir:"rtl",children:[e.jsx("h2",{className:"text-3xl font-bold mb-8 text-right text-gray-800 border-b pb-4",children:"إضافة خدمة جديدة"}),e.jsx("div",{className:"flex flex-col lg:flex-row gap-10",children:e.jsxs("form",{onSubmit:d,className:"w-full grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex gap-10",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"العنوان"}),e.jsx("input",{type:"text",value:a.title,onChange:t=>y(t,"title"),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-right focus:outline-none",required:!0,disabled:n})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"القسم"}),e.jsxs("select",{value:a.sectionId,onChange:t=>y(t,"sectionId"),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-right focus:outline-none",required:!0,disabled:n,children:[e.jsx("option",{value:"",children:"اختر قسمًا"}),C.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]})]}),e.jsx("div",{className:"md:col-span-1 row-span-3 flex justify-center",children:e.jsxs("div",{className:"relative w-100 lg:h-70 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center cursor-pointer hover:bg-gray-100 transition",onClick:()=>document.getElementById("imageUpload").click(),children:[x?e.jsx("img",{src:x,alt:"Preview",className:"w-full h-full object-cover rounded-lg"}):e.jsx("span",{className:"text-gray-400 text-lg text-center",children:"اضغط لرفع صورة"}),e.jsx("input",{type:"file",id:"imageUpload",onChange:z,className:"hidden",accept:"image/*",disabled:n})]})}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"العنوان الفرعي"}),e.jsx("input",{type:"text",value:a.subTitle,onChange:t=>y(t,"subTitle"),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-right focus:outline-none",disabled:n})]}),e.jsxs("div",{className:"",dir:"rtl",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"الوصف"}),e.jsx("div",{className:"flex items-start gap-2",children:e.jsx("textarea",{rows:3,value:b,onChange:t=>m(t.target.value),onKeyDown:D,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 text-right focus:ring-blue-500 resize-none focus:outline-none",disabled:n,placeholder:"اكتب الوصف واضغط Enter لإضافته"})}),e.jsx(P,{children:a.description.map((t,i)=>e.jsxs(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},className:"flex items-start gap-2 mt-2",children:[e.jsx("span",{className:"w-full p-3 bg-gray-100 rounded-lg text-right",children:t}),e.jsx("button",{type:"button",onClick:()=>s("description",i),className:"text-red-600 hover:text-red-800 mt-1",disabled:n,children:e.jsx(L,{})})]},i))})]}),e.jsxs("div",{className:"md:col-span-2",dir:"rtl",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("div",{className:"flex items-start gap-2",children:e.jsx("textarea",{rows:3,value:h,onChange:t=>p(t.target.value),onKeyDown:E,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 text-right focus:ring-blue-500 resize-none focus:outline-none",disabled:n,placeholder:"اكتب ميزة واضغط Enter لإضافتها"})}),e.jsx(P,{children:a.features.map((t,i)=>e.jsxs(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},className:"flex items-start gap-2 mt-2",children:[e.jsx("span",{className:"w-full p-3 bg-gray-100 rounded-lg text-right",children:t}),e.jsx("button",{type:"button",onClick:()=>s("features",i),className:"text-red-600 hover:text-red-800 mt-1",disabled:n,children:e.jsx(L,{})})]},i))})]}),e.jsxs("div",{className:"md:col-span-2 flex justify-between items-center mt-8",children:[e.jsx("button",{type:"button",onClick:w,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition cursor-pointer",disabled:n,children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2 cursor-pointer",disabled:n,children:n?e.jsx(F,{className:"animate-spin",size:20}):"إضافة"})]})]})})]})},"Add-Service-Modal"):null},Y=({isOpen:S,onClose:w,sections:C,service:c,updateService:a})=>{const[r,x]=o.useState({title:"",subTitle:"",sectionId:"",description:[],features:[]}),[g,n]=o.useState(""),[f,b]=o.useState(""),[m,h]=o.useState(!1);o.useEffect(()=>{var s,d,t;c&&x({title:c.title||"",subTitle:c.subTitle||"",sectionId:((s=c.section)==null?void 0:s._id)||"",description:((d=c.description)==null?void 0:d.length)>0?c.description:[],features:((t=c.features)==null?void 0:t.length)>0?c.features:[]})},[c]);const p=(s,d)=>{x({...r,[d]:s.target.value})},y=()=>{g.trim()&&(x({...r,description:[...r.description,g.trim()]}),n(""))},I=()=>{f.trim()&&(x({...r,features:[...r.features,f.trim()]}),b(""))},T=s=>{s.key==="Enter"&&g.trim()&&(s.preventDefault(),y())},D=s=>{s.key==="Enter"&&f.trim()&&(s.preventDefault(),I())},E=(s,d)=>{const t=r[s].filter((i,u)=>u!==d);x({...r,[s]:t})},z=async s=>{s.preventDefault(),h(!0);const d={title:r.title,subTitle:r.subTitle,sectionId:r.sectionId,description:[...r.description.filter(t=>t.trim()!==""),...g.trim()?[g.trim()]:[]],features:[...r.features.filter(t=>t.trim()!==""),...f.trim()?[f.trim()]:[]]};try{const t=await a(c._id,d);t.success?(j.success(t.message),w(),n(""),b("")):j.error(t.message||"حدث خطأ أثناء تعديل الخدمة")}catch(t){j.error(t.message||"حدث خطأ أثناء تعديل الخدمة")}finally{h(!1)}};return!S||!c?null:e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-500 p-4 md:mt-20",children:e.jsxs(N.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl shadow-2xl w-full h-full max-h-screen overflow-auto p-8 md:p-12",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-6 text-right",children:"تعديل الخدمة"}),e.jsxs("form",{onSubmit:z,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"العنوان الفرعي"}),e.jsx("input",{type:"text",value:r.subTitle,onChange:s=>p(s,"subTitle"),className:"mt-1 block w-full p-2 border border-gray-500 rounded-md focus:outline-none text-right",disabled:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"العنوان"}),e.jsx("input",{type:"text",value:r.title,onChange:s=>p(s,"title"),className:"mt-1 block w-full p-2 border border-gray-500 rounded-md focus:outline-none text-right",required:!0,disabled:m})]}),e.jsx("div",{}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-right",children:"القسم"}),e.jsxs("select",{value:r.sectionId,onChange:s=>p(s,"sectionId"),className:"mt-1 block w-full p-2 border border-gray-500 rounded-md focus:outline-none text-right cursor-pointer",required:!0,disabled:m,children:[e.jsx("option",{value:"",children:"اختر قسمًا"}),C.map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]})]}),e.jsxs("div",{className:"md:col-span-2",dir:"rtl",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"الوصف"}),e.jsx("div",{className:"flex items-start gap-2",children:e.jsx("textarea",{rows:3,value:g,onChange:s=>n(s.target.value),onKeyDown:T,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 text-right focus:ring-blue-500 resize-none focus:outline-none",disabled:m,placeholder:"اكتب الوصف واضغط Enter لإضافته"})}),e.jsx(P,{children:r.description.map((s,d)=>e.jsxs(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},className:"flex items-start gap-2 mt-2",children:[e.jsx("span",{className:"w-full p-3 bg-gray-100 rounded-lg text-right",children:s}),e.jsx("button",{type:"button",onClick:()=>E("description",d),className:"text-red-600 hover:text-red-800 mt-1",disabled:m,children:e.jsx(L,{})})]},d))})]}),e.jsxs("div",{className:"md:col-span-2",dir:"rtl",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("div",{className:"flex items-start gap-2",children:e.jsx("textarea",{rows:3,value:f,onChange:s=>b(s.target.value),onKeyDown:D,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 text-right focus:ring-blue-500 resize-none focus:outline-none",disabled:m,placeholder:"اكتب ميزة واضغط Enter لإضافتها"})}),e.jsx(P,{children:r.features.map((s,d)=>e.jsxs(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},className:"flex items-start gap-2 mt-2",children:[e.jsx("span",{className:"w-full p-3 bg-gray-100 rounded-lg text-right",children:s}),e.jsx("button",{type:"button",onClick:()=>E("features",d),className:"text-red-600 hover:text-red-800 mt-1",disabled:m,children:e.jsx(L,{})})]},d))})]}),e.jsxs("div",{className:"md:col-span-2 flex justify-end gap-2 space-x-reverse mt-4",children:[e.jsx("button",{type:"button",onClick:w,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-all duration-200 cursor-pointer",disabled:m,children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 cursor-pointer flex items-center gap-2",disabled:m,children:m?e.jsx(F,{className:"animate-spin",size:20}):"حفظ التعديلات"})]})]})]})},"Edit-Service-Modal")},Z=({isOpen:S,onClose:w,service:C,updateServiceImage:c})=>{const[a,r]=o.useState(null),[x,g]=o.useState(null),[n,f]=o.useState(!1),b=h=>{const p=h.target.files[0];p&&(g(URL.createObjectURL(p)),r(p))},m=async h=>{if(h.preventDefault(),!a){j.error("يرجى اختيار صورة للتحديث");return}f(!0);const p=new FormData;p.append("image",a);try{const y=await c(C._id,p);y.success?j.success(y.message):j.error(y.message),w(),r(null),g(null)}catch(y){j.error(y.message)}finally{f(!1)}};return S?e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(N.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.3},className:"bg-white rounded-lg p-4 sm:p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-6 text-right",children:"تحديث الصورة"}),e.jsxs("form",{onSubmit:m,children:[e.jsx("div",{className:"w-full flex justify-center",children:e.jsxs("div",{className:"relative w-full h-64 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center cursor-pointer hover:bg-gray-100 transition",onClick:()=>document.getElementById("imageUpload").click(),children:[x?e.jsx("img",{src:x,alt:"Preview",className:"w-full h-full object-cover rounded-lg"}):e.jsx("span",{className:"text-gray-400 text-lg text-center",children:"اضغط لرفع صورة"}),e.jsx("input",{type:"file",id:"imageUpload",onChange:b,className:"hidden",accept:"image/*",disabled:n})]})}),e.jsxs("div",{className:"flex justify-end gap-2 space-x-reverse mt-4",children:[e.jsx("button",{type:"button",onClick:w,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-all duration-200 cursor-pointer",disabled:n,children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 cursor-pointer flex items-center gap-2",disabled:n,children:n?e.jsx(F,{className:"animate-spin",size:20}):"تحديث"})]})]})]})},"image-modal"):null},ce=()=>{const[S,w]=_(),{sections:C}=K(),{services:c,total:a,loading:r,page:x,totalPages:g,handlePageChange:n,addService:f,updateService:b,deleteService:m,updateServiceImage:h}=G(),p=S.get("search")||"",[y,I]=o.useState(p),[T,D]=o.useState(!1),[E,z]=o.useState(!1),[s,d]=o.useState(!1),[t,i]=o.useState(null),[u,k]=o.useState(null),M=l=>{i(l),z(!0)},U=l=>{i(l),d(!0)},O=async l=>{if((await $.fire({title:"هل أنت متأكد؟",text:"لن تتمكن من التراجع عن هذا!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"نعم، احذف!",cancelButtonText:"إلغاء"})).isConfirmed){k(l);try{const v=await m(l);v.success?j.success(v.message):j.error(v.message)}catch(v){j.error(v.message||"حدث خطأ أثناء الحذف")}finally{k(null)}}},R=l=>{I(l),w(A=>{const v=new URLSearchParams(A);return l?(v.set("search",l),v.set("page","1")):v.delete("search"),v})};return o.useEffect(()=>{const l=S.get("search")||"";I(l)},[S]),e.jsx("div",{className:"p-4 sm:p-6 bg-gray-100 min-h-screen overflow-x-auto",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-auto sm:max-w-md",dir:"rtl",children:[e.jsx(H,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",value:y,onChange:l=>R(l.target.value),placeholder:"ابحث عن خدمات...",className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none text-right"})]}),e.jsxs("button",{onClick:()=>D(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer transition-all duration-200 w-full sm:w-auto",children:[e.jsx(J,{size:20}),"إضافة خدمة جديدة"]})]}),e.jsx(X,{isOpen:T,onClose:()=>D(!1),sections:C,addService:f}),e.jsx(Y,{isOpen:E,onClose:()=>z(!1),sections:C,service:t,updateService:b}),e.jsx(Z,{isOpen:s,onClose:()=>d(!1),service:t,updateServiceImage:h}),r?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(F,{className:"animate-spin text-blue-500",size:32})}):e.jsxs(B.Fragment,{children:[e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-right",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-2 sm:px-4 py-3 text-xs font-medium text-gray-500 tracking-wider whitespace-nowrap",children:"الصورة"}),e.jsx("th",{className:"text-center px-2 sm:px-4 py-3 text-xs font-medium text-gray-500 tracking-wider whitespace-nowrap",children:"العنوان"}),e.jsx("th",{className:"text-center px-2 sm:px-4 py-3 text-xs font-medium text-gray-500 tracking-wider whitespace-nowrap",children:"القسم"}),e.jsx("th",{className:"text-center px-2 sm:px-4 py-3 text-xs font-medium text-gray-500 tracking-wider whitespace-nowrap",children:"تاريخ الإنشاء"}),e.jsx("th",{className:"text-center px-2 sm:px-4 py-3 text-xs font-medium text-gray-500 tracking-wider whitespace-nowrap",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.length>0?c.map(l=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 sm:px-4 py-4 whitespace-nowrap text-sm text-gray-900 text-center",children:e.jsx("img",{src:l.image.thumbnailMedium,alt:l.title,className:"w-10 h-10 sm:w-12 sm:h-12 object-cover rounded cursor-pointer mx-auto",onClick:()=>U(l)})}),e.jsx("td",{className:"px-2 sm:px-4 py-4 whitespace-nowrap text-sm text-gray-900 max-w-[150px] sm:max-w-[200px] truncate",children:l.title}),e.jsx("td",{className:"px-2 sm:px-4 py-4 whitespace-nowrap text-sm text-gray-500 max-w-[120px] sm:max-w-[150px] truncate",children:l.section.title}),e.jsx("td",{className:"px-2 sm:px-4 py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500",children:new Date(l.createdAt).toLocaleDateString("ar-EG")}),e.jsxs("td",{className:"px-2 sm:px-4 py-8 whitespace-nowrap text-sm flex gap-5 items-center justify-center",children:[e.jsx("button",{onClick:()=>M(l),className:"text-blue-600 hover:text-blue-800 cursor-pointer",title:"تعديل الخدمة",children:e.jsx(Q,{size:16})}),e.jsx("button",{onClick:()=>O(l._id),className:"text-red-600 hover:text-red-800 cursor-pointer",title:"حذف الخدمة",disabled:u===l._id,children:u===l._id?e.jsx(F,{className:"animate-spin",size:16}):e.jsx(V,{size:16})})]})]},l._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-2 sm:px-4 py-4 text-center text-sm text-gray-500",children:"لا توجد خدمات متاحة"})})})]})}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row sm:justify-between items-center gap-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["عرض ",c.length," من ",a," خدمة"]}),e.jsxs("div",{className:"flex items-center gap-2 space-x-reverse",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["صفحة ",x," من ",g]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(x+1),disabled:x===g,className:"p-2 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50 cursor-pointer transition-all duration-200",children:e.jsx(W,{size:20})}),e.jsx("button",{onClick:()=>n(x-1),disabled:x===1,className:"p-2 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50 cursor-pointer transition-all duration-200",children:e.jsx(q,{size:20})})]})]})]})]})]})})};export{ce as default};
