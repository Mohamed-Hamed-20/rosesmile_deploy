import{c as he,r as t,f as ie,a as Q,V as ae,j as e,z as D,R as be,D as A,d as pe,y as $}from"./index-BzNwyTTe.js";import{L as le,S as fe}from"./sweetalert2.esm.all-Cxdeaupf.js";import{A as I}from"./index-Dn6cvt5g.js";import{S as ye}from"./search-SKB_sI0d.js";import{P as je,T as Ne}from"./trash-2-Ds3YWRdD.js";import{C as we}from"./chevron-left-tkGkg_Wo.js";/**
 * @license lucide-react v0.485.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],C=he("arrow-down",ve),ke=()=>{const[a,O]=t.useState([]),[w,F]=t.useState(0),[S,g]=t.useState(!1),[z,v]=t.useState(!1),[h,U]=ie(),f="http://localhost:5000/api/v1/user",k=parseInt(h.get("page"))||1,y=6,B=h.get("search")||"",j=h.get("role")||"",l=h.get("isBlocked")||"",b=h.get("isConfirmed")||"",n=h.get("sort")||"email:asc",R=async()=>{g(!0);try{const x=new URLSearchParams({page:k.toString(),size:y.toString(),search:B,...j&&{role:j},...l&&{isBlocked:l},...b&&{isConfirmed:b},sort:n}).toString(),r=await Q.get(`${f}/admin?${x}`,{withCredentials:!0});O(r.data.users||[]),F(r.data.totalUsers||0)}catch(x){console.error("Failed to fetch users:",x)}finally{g(!1)}},c=async x=>{var r,p;v(!0);try{const i=await Q.delete(`${f}/delete/${x}`,{withCredentials:!0});return await R(),{success:!0,message:i.data.message}}catch(i){return{success:!1,message:((p=(r=i.response)==null?void 0:r.data)==null?void 0:p.message)||"فشل في الحذف"}}finally{v(!1)}},E=async(x,r)=>{var p,i;try{const P=await Q.put(`${f}/admin/${x}`,{role:r.role,block:r.block,confirm:r.confirm},{withCredentials:!0});await R(),ae.success(P.data.message||"تم تعديل المستخدم بنجاح")}catch(P){ae.error(((i=(p=P.response)==null?void 0:p.data)==null?void 0:i.message)||"فشل في تعديل المستخدم"),console.error("Failed to edit user:",P)}};t.useEffect(()=>{R()},[k,y,B,j,l,b,n]);const d=x=>{U(r=>{const p=new URLSearchParams(r);return p.set("page",x.toString()),p})};return{users:a,total:w,page:k,size:y,totalPages:Math.ceil(w/y),loading:S,deleteLoading:z,deleteUser:c,editUser:E,handlePageChange:d}},Ce=({user:a,onClose:O,onSave:w})=>{const[F,S]=t.useState(a.role||"user"),[g,z]=t.useState(a.isBlocked?"yes":"no"),[v,h]=t.useState(a.isConfirmed?"yes":"no"),[U,f]=t.useState(!1),[k,y]=t.useState(!1),[B,j]=t.useState(!1),l=()=>{const n={role:F,block:g,confirm:v};w(a._id,n),O()},b={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0,transition:{duration:.2}},exit:{opacity:0,y:-10,transition:{duration:.2}}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-500",dir:"rtl",children:e.jsxs(D.div,{initial:"hidden",animate:"visible",exit:"exit",variants:b,className:"bg-white rounded-lg p-6 w-full max-w-xl",children:[e.jsxs("h2",{className:"text-xl mb-4",children:["تعديل المستخدم: ",e.jsx("span",{className:"font-semibold",children:a.email})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>f(!U),className:"w-full px-4 py-2 border border-gray-400 rounded-lg shadow-sm focus:outline-none text-right bg-white cursor-pointer",children:F}),e.jsx(I,{children:U&&e.jsxs(D.div,{variants:b,initial:"hidden",animate:"visible",exit:"exit",className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg text-right",children:[e.jsx("button",{onClick:()=>{S("user"),f(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"user"}),e.jsx("button",{onClick:()=>{S("admin"),f(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"admin"}),e.jsx("button",{onClick:()=>{S("superadmin"),f(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"superadmin"})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>y(!k),className:"w-full px-4 py-2 border border-gray-400 cursor-pointer rounded-lg shadow-sm focus:outline-none text-right bg-white",children:g==="yes"?"محظور":"غير محظور"}),e.jsx(I,{children:k&&e.jsxs(D.div,{variants:b,initial:"hidden",animate:"visible",exit:"exit",className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg text-right",children:[e.jsx("button",{onClick:()=>{z("no"),y(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"لا"}),e.jsx("button",{onClick:()=>{z("yes"),y(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"نعم"})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>j(!B),className:"w-full px-4 py-2 border border-gray-400 cursor-pointer rounded-lg shadow-sm focus:outline-none text-right bg-white",children:v==="yes"?"مؤكد":"غير مؤكد"}),e.jsx(I,{children:B&&e.jsxs(D.div,{variants:b,initial:"hidden",animate:"visible",exit:"exit",className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg text-right",children:[e.jsx("button",{onClick:()=>{h("no"),j(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"لا"}),e.jsx("button",{onClick:()=>{h("yes"),j(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"نعم"})]})})]})]}),e.jsxs("div",{className:"mt-6 flex justify-start gap-2",children:[e.jsx("button",{onClick:O,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 cursor-pointer transition-all duration-200",children:"إلغاء"}),e.jsx("button",{onClick:l,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer transition-all duration-200",children:"حفظ"})]})]})})},Oe=()=>{const[a,O]=ie(),{users:w,total:F,loading:S,page:g,totalPages:z,handlePageChange:v,deleteUser:h,editUser:U}=ke(),f=a.get("search")||"",k=a.get("role")||"",y=a.get("blocked")||"",B=a.get("confirmed")||"",j=a.get("sort")||"email:asc",[l,b]=t.useState(f),[n,R]=t.useState(k),[c,E]=t.useState(y),[d,x]=t.useState(B),[r,p]=t.useState(j.split(":")[0]),[i,P]=t.useState(j.split(":")[1]),[W,X]=t.useState(null),[Y,L]=t.useState(!1),[Z,M]=t.useState(!1),[ee,T]=t.useState(!1),[oe,V]=t.useState(!1),[ne,se]=t.useState(!1),[m,q]=t.useState(null),[G,te]=t.useState(""),ce=s=>{q(s),te(""),V(!0)},de=async()=>{if(!m)return;if(G==""){$.error(".يرجي ادخال البريد الالكتروني المراد حذفه");return}if(G!==m.email){$.error("البريد الإلكتروني غير متطابق، يرجى التأكد من الإدخال.");return}if(V(!1),(await fe.fire({title:"هل أنت متأكد؟",text:"لن تتمكن من التراجع عن هذا!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"نعم، احذف!",cancelButtonText:"إلغاء"})).isConfirmed){X(m._id);try{const o=await h(m._id);o.success?$.success(o.message):$.error(o.message)}catch(o){$.error(o.message||"حدث خطأ أثناء الحذف")}finally{X(null),q(null)}}},xe=s=>{q(s),se(!0)},u=(s,o,J,K,re)=>{b(s),R(o),E(J),x(K);const[me,ue]=re.split(":");p(me),P(ue),O(ge=>{const N=new URLSearchParams(ge);return s?N.set("search",s):N.delete("search"),o?N.set("role",o):N.delete("role"),J?N.set("isBlocked",J):N.delete("isBlocked"),K?N.set("isConfirmed",K):N.delete("isConfirmed"),N.set("sort",re),N})},_=s=>{u(l,n,c,d,`${s}:${r===s&&i==="asc"?"desc":"asc"}`)};t.useEffect(()=>{b(a.get("search")||""),R(a.get("role")||""),E(a.get("isBlocked")||""),x(a.get("isConfirmed")||"");const[s,o]=(a.get("sort")||"email:asc").split(":");p(s),P(o)},[a]);const H={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0,transition:{duration:.2}},exit:{opacity:0,y:-10,transition:{duration:.2}}};return e.jsx("div",{className:"p-4 sm:p-6 bg-gray-100 min-h-screen overflow-x-auto",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{className:"flex flex-col justify-between sm:flex-row gap-4 w-full",children:[e.jsxs("div",{className:"relative w-full sm:w-64 flex items-center",children:[e.jsx(ye,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",value:l,onChange:s=>u(s.target.value,n,c,d),placeholder:"ابحث عن مستخدم...",className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none text-right"})]}),e.jsxs("div",{className:"flex gap-5 items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>L(!Y),className:"w-full sm:w-32 px-4 py-2 border border-gray-400 rounded-lg shadow-sm focus:outline-none text-right bg-white cursor-pointer",children:n||"الدور"}),e.jsx(I,{children:Y&&e.jsxs(D.div,{variants:H,initial:"hidden",animate:"visible",exit:"exit",className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg text-right",children:[e.jsx("button",{onClick:()=>{u(l,"",c,d),L(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"الكل"}),e.jsx("button",{onClick:()=>{u(l,"user",c,d),L(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"user"}),e.jsx("button",{onClick:()=>{u(l,"admin",c,d),L(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"admin"}),e.jsx("button",{onClick:()=>{u(l,"superadmin",c,d),L(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"superadmin"})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>M(!Z),className:"w-full sm:w-32 px-4 py-2 border border-gray-400 rounded-lg shadow-sm focus:outline-none text-right bg-white cursor-pointer",children:c==="yes"?"محظور":c==="no"?"غير محظور":"الحظر"}),e.jsx(I,{children:Z&&e.jsxs(D.div,{variants:H,initial:"hidden",animate:"visible",exit:"exit",className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg text-right",children:[e.jsx("button",{onClick:()=>{u(l,n,"",d),M(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"الكل"}),e.jsx("button",{onClick:()=>{u(l,n,"yes",d),M(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"نعم"}),e.jsx("button",{onClick:()=>{u(l,n,"no",d),M(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"لا"})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>T(!ee),className:"w-full sm:w-32 px-4 py-2 border border-gray-400 rounded-lg shadow-sm focus:outline-none text-right bg-white cursor-pointer",children:d==="yes"?"مؤكد":d==="no"?"غير مؤكد":"التأكيد"}),e.jsx(I,{children:ee&&e.jsxs(D.div,{variants:H,initial:"hidden",animate:"visible",exit:"exit",className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg text-right",children:[e.jsx("button",{onClick:()=>{u(l,n,c,""),T(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"الكل"}),e.jsx("button",{onClick:()=>{u(l,n,c,"yes"),T(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"نعم"}),e.jsx("button",{onClick:()=>{u(l,n,c,"no"),T(!1)},className:"block w-full px-4 py-2 text-sm hover:bg-gray-100 border-b border-gray-300 cursor-pointer",children:"لا"})]})})]})]})]})}),S?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(le,{className:"animate-spin text-blue-500",size:32})}):e.jsxs(be.Fragment,{children:[e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-right",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"الصورة"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500 cursor-pointer hover:text-gray-700 transition-colors duration-200",onClick:()=>_("firstName"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["الاسم",r==="firstName"&&i==="asc"?e.jsx(A,{size:16,className:"text-blue-500"}):r==="firstName"&&i==="desc"?e.jsx(C,{size:16,className:"text-blue-500"}):e.jsx(C,{size:16,className:"text-gray-500"})]})}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500 cursor-pointer",onClick:()=>_("email"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["البريد الإلكتروني",r==="email"&&i==="asc"?e.jsx(A,{size:16,className:"text-blue-500"}):r==="email"&&i==="desc"?e.jsx(C,{size:16,className:"text-blue-500"}):e.jsx(C,{size:16,className:"text-gray-500"})]})}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500 cursor-pointer",onClick:()=>_("role"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["الدور",r==="role"&&i==="asc"?e.jsx(A,{size:16,className:"text-blue-500"}):r==="role"&&i==="desc"?e.jsx(C,{size:16,className:"text-blue-500"}):e.jsx(C,{size:16,className:"text-gray-500"})]})}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500 cursor-pointer",onClick:()=>_("isConfirmed"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["مؤكد",r==="isConfirmed"&&i==="asc"?e.jsx(A,{size:16,className:"text-blue-500"}):r==="isConfirmed"&&i==="desc"?e.jsx(C,{size:16,className:"text-blue-500"}):e.jsx(C,{size:16,className:"text-gray-500"})]})}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"محظور"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200 text-center",children:w.length>0?w.map(s=>{var o;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("img",{src:((o=s.image)==null?void 0:o.url)||"/user.png",alt:`${s.firstName} ${s.lastName}`,className:"w-10 h-10 rounded-full object-cover mx-auto"})}),e.jsxs("td",{className:"px-4 py-3 truncate max-w-[150px]",children:[s.firstName," ",s.lastName]}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.email}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full 
                              ${s.role==="admin"?"bg-yellow-100 text-yellow-800":s.role==="super admin"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}
                            `,children:s.role})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.isConfirmed?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.isBlocked?"نعم":"لا"}),e.jsxs("td",{className:"px-4 py-3 flex gap-4 justify-center items-center mt-3",children:[e.jsx("button",{onClick:()=>xe(s),className:"text-blue-600 hover:text-blue-800 cursor-pointer",title:"تعديل الخدمة",children:e.jsx(je,{size:16})}),e.jsx("button",{onClick:()=>ce(s),className:"text-red-600 hover:text-red-800 cursor-pointer",title:"حذف",disabled:W===s._id,children:W===s._id?e.jsx(le,{size:16,className:"animate-spin"}):e.jsx(Ne,{size:16})})]})]},s._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"py-6 text-center text-sm text-gray-500",children:"لا يوجد مستخدمين حاليًا"})})})]})}),e.jsx(I,{children:ne&&m&&e.jsx(Ce,{user:m,onClose:()=>se(!1),onSave:U})}),oe&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",dir:"rtl",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md text-right",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 ",children:"حذف المستخدم"}),e.jsxs("p",{className:"mb-2",children:["سيتم حذف المستخدم"," ",e.jsx("span",{className:"font-semibold",children:m==null?void 0:m.email})," ","نهائيًا مع كل بياناته."]}),e.jsx("p",{className:"mb-4 text-red-600 bg-red-100 p-2 rounded",children:"تحذير: هذا الإجراء لا يمكن التراجع عنه. يرجى التأكد."}),e.jsxs("label",{className:"block mb-2",children:["أدخل البريد الإلكتروني للتأكيد (",m==null?void 0:m.email,"):"]}),e.jsx("input",{type:"text",value:G,onChange:s=>te(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-4",placeholder:"أدخل البريد الإلكتروني",required:!0}),e.jsxs("div",{className:"flex justify-start gap-2",children:[e.jsx("button",{onClick:()=>V(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 cursor-pointer transition-all duration-200",children:"إلغاء"}),e.jsx("button",{onClick:de,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 cursor-pointer transition-all duration-200",children:"حذف"})]})]})}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row justify-between items-center gap-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["عرض ",w.length," من ",F," مستخدم"]}),e.jsxs("div",{className:"flex items-center gap-2 space-x-reverse",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["صفحة ",g," من ",z]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>v(g-1),disabled:g===1,className:"p-2 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50",children:e.jsx(we,{size:20})}),e.jsx("button",{onClick:()=>v(g+1),disabled:g===z,className:"p-2 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50",children:e.jsx(pe,{size:20})})]})]})]})]})]})})};export{Oe as default};
