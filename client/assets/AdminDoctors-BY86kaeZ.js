import{c as q,r,j as e,z as O,y,X as W,d as F,f as K,a as A,R as Z}from"./index-BzNwyTTe.js";import{L as T,S as V}from"./sweetalert2.esm.all-Cxdeaupf.js";import G from"./AddDoctorModal-FgfHgQz5.js";import J from"./EditDoctorModal-Cy1E6Tga.js";import{u as Q}from"./useDoctorDetails-CeaJ29rW.js";import{C as H}from"./chevron-left-tkGkg_Wo.js";import{S as Y}from"./search-SKB_sI0d.js";import{P as ee}from"./plus-BZcG7NK8.js";import{P as te,T as se}from"./trash-2-Ds3YWRdD.js";import"./index-Dn6cvt5g.js";import"./minus-lsm2JIKY.js";/**
 * @license lucide-react v0.485.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],re=q("folder-plus",ae),ne=({isOpen:m,onClose:k,doctor:n,updateDoctorImage:E})=>{var p,v;const[D,l]=r.useState(null),[b,h]=r.useState(null),[w,j]=r.useState(!1);r.useEffect(()=>{m||(l(null),h(null))},[m]),r.useEffect(()=>{const x=i=>{i.ctrlKey&&i.shiftKey&&i.key.toLowerCase()==="x"&&(i.preventDefault(),k())};return window.addEventListener("keydown",x),()=>{window.removeEventListener("keydown",x)}},[]);const I=x=>{const i=x.target.files[0];i&&(h(URL.createObjectURL(i)),l(i))},g=()=>{l(null),h(null),k()},L=async x=>{if(x.preventDefault(),!D){y.error("يرجى اختيار صورة للتحديث");return}j(!0);const i=new FormData;i.append("image",D);try{const u=await E(n._id,i);u.success?(y.success(u.message),g()):y.error(u.message||"فشل تحديث صورة الطبيب")}catch(u){y.error(u.message||"حدث خطأ أثناء تحديث الصورة")}finally{j(!1)}};return!m||!n?null:e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black/60 flex items-center justify-center z-500 p-4",children:e.jsxs(O.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl shadow-2xl w-full max-w-xl p-8",dir:"rtl",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800 text-right border-b pb-3",children:"تحديث صورة الطبيب"}),e.jsxs("form",{onSubmit:L,children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs("div",{className:"relative rounded-lg overflow-hidden border-2 border-dashed border-gray-300 hover:border-blue-500 transition-colors duration-200 aspect-[3/4] w-full max-w-xs cursor-pointer group",onClick:()=>document.getElementById("doctorImageUpload").click(),children:[b||(p=n.image)!=null&&p.url?e.jsxs("div",{className:"w-full h-full relative group",children:[e.jsx("img",{src:b||((v=n.image)==null?void 0:v.url),alt:"Preview",className:"w-full h-full object-cover object-top"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-medium",children:"تغيير الصورة"})})]}):e.jsx("div",{className:"text-center p-6",children:e.jsx("div",{className:"mb-3 text-gray-400",children:e.jsx("svg",{className:"mx-auto h-12 w-12",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})}),e.jsx("input",{type:"file",id:"doctorImageUpload",onChange:I,className:"hidden",accept:"image/*",disabled:w})]})}),e.jsxs("div",{className:"flex justify-between items-center gap-2 mt-4",children:[e.jsx("button",{type:"button",onClick:g,title:"يمكنك أيضًا الإغلاق باستخدام Ctrl + Shift + X",className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition cursor-pointer",disabled:w,children:"إغلاق"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2 cursor-pointer",disabled:w,children:w?e.jsx(T,{className:"animate-spin",size:20}):"تحديث الصورة"})]})]})]})},"Update-Doctor-Image-Modal")},ie=({isOpen:m,onClose:k,doctor:n,addCase:E,deleteCase:D})=>{var o,d;const{doctor:l,loading:b,refetch:h}=Q(n==null?void 0:n._id),[w,j]=r.useState(!0),[I,g]=r.useState(null),[L,p]=r.useState(null),[v,x]=r.useState(!1),[i,u]=r.useState(!1),[N,C]=r.useState(0);r.useEffect(()=>{j(!0),g(null),p(null)},[n==null?void 0:n._id]),r.useEffect(()=>{!b&&l&&l._id===(n==null?void 0:n._id)&&j(!1)},[b,l,n==null?void 0:n._id]),r.useEffect(()=>{const t=s=>{i&&(s.key==="ArrowRight"?$():s.key==="ArrowLeft"?_():s.key==="Escape"&&P())};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[i,(o=l==null?void 0:l.cases)==null?void 0:o.length,N]),r.useEffect(()=>{const t=s=>{s.ctrlKey&&s.shiftKey&&s.key.toLowerCase()==="x"&&(s.preventDefault(),k())};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[]),r.useEffect(()=>{m||(u(!1),C(0))},[m,n==null?void 0:n._id]);const f=t=>{const s=t.target.files[0];s&&(g(s),p(URL.createObjectURL(s)))},B=()=>{g(null),p(null)},U=async()=>{if(!I)return y.error("يرجى اختيار صورة أولاً");const t=new FormData;t.append("image",I),x(!0);const s=await E(n._id,t);x(!1),s.success?(y.success("تمت الإضافة بنجاح"),g(null),p(null),await h()):y.error(s.message||"فشل في الإضافة")},z=async t=>{if((await V.fire({title:"هل أنت متأكد؟",text:".سيتم حذف هذه الحالة نهائيًا",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، احذف",cancelButtonText:"إلغاء",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed){const c=await D(n._id,t);c.success?(y.success("تم حذف الحالة"),await h()):y.error(c.message)}},M=t=>{C(t),u(!0)},P=()=>u(!1),_=()=>{C(t=>t===0?l.cases.length-1:t-1)},$=()=>{C(t=>t===l.cases.length-1?0:t+1)};return m?w?e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-500 p-4",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg flex items-center gap-3",children:[e.jsx(T,{className:"animate-spin text-blue-600",size:24}),e.jsx("span",{className:"text-blue-800 font-medium",children:"...جاري تحميل بيانات حالات الطبيب"})]})}):e.jsxs(e.Fragment,{children:[i&&e.jsxs("div",{className:"fixed inset-0 z-[600] bg-black bg-opacity-90 flex items-center justify-center",children:[e.jsx("button",{onClick:P,className:"absolute top-4 right-4 text-white cursor-pointer",children:e.jsx(W,{size:28})}),e.jsx("button",{onClick:_,className:"absolute left-4 text-white cursor-pointer",children:e.jsx(H,{size:40})}),e.jsx("img",{src:l.cases[N].url,alt:"Case",className:"max-h-[90vh] max-w-[90vw] object-contain rounded-lg"}),e.jsx("button",{onClick:$,className:"absolute right-4 text-white cursor-pointer",children:e.jsx(F,{size:40})})]}),e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black/60 flex items-center justify-center z-500 p-4",children:e.jsxs(O.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl shadow-2xl w-full max-w-5xl h-full max-h-[95vh] min-h-[90vh] overflow-y-auto flex flex-col box-border p-8 md:p-10",dir:"rtl",children:[e.jsxs("h2",{className:"text-2xl font-semibold mb-6 text-blue-900 border-b pb-4",children:["إدارة الحالات للطبيب: ",l.name]}),e.jsx("div",{className:"overflow-y-auto max-h-[500px] mb-10 pr-1",children:((d=l.cases)==null?void 0:d.length)>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:l.cases.map((t,s)=>e.jsxs("div",{className:"relative bg-white border border-gray-300 rounded-lg shadow-sm p-2",children:[e.jsx("img",{src:t.url,alt:`حالة ${s+1}`,className:"w-full aspect-square object-cover rounded-t cursor-pointer hover:opacity-90 transition",onClick:()=>M(s)}),e.jsx("button",{onClick:()=>z(t._id),className:"absolute bottom-2 left-2 bg-red-600 hover:bg-red-700 text-white text-sm px-3 py-1 rounded shadow-md transition cursor-pointer",children:"حذف"})]},t._id))}):e.jsx("p",{className:"text-gray-500 text-center",children:"لا توجد حالات حالياً لهذا الطبيب."})}),e.jsxs("div",{className:"bg-white border border-gray-300 rounded-lg shadow-sm px-6 py-5 mb-6 flex flex-col md:flex-row items-center gap-6",children:[e.jsxs("label",{className:"cursor-pointer text-blue-700 text-sm",children:[L?e.jsx("img",{src:L,alt:"Preview",className:"w-28 h-28 object-cover rounded shadow border"}):e.jsx("div",{className:"w-28 h-28 flex items-center justify-center bg-white rounded border text-center text-xs ",children:"اضغط هنا لاختيار صورة"}),e.jsx("input",{type:"file",accept:"image/*",onChange:f,className:"hidden"})]}),e.jsx("div",{className:"flex-1 w-full flex flex-col gap-2",children:e.jsxs("div",{className:"flex  gap-3",children:[e.jsx("button",{onClick:U,disabled:v,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded text-sm transition cursor-pointer",children:v?e.jsx(T,{className:"animate-spin mx-auto",size:18}):"تأكيد الإضافة"}),L&&e.jsx("button",{onClick:B,className:"flex-1 bg-gray-200 text-gray-700 py-2 rounded text-sm hover:bg-gray-300 transition cursor-pointer",children:"مسح الصورة"})]})})]}),e.jsx("div",{className:"flex justify-end border-t pt-6",children:e.jsx("button",{onClick:k,title:"يمكنك أيضًا الإغلاق باستخدام Ctrl + Shift + X",className:"px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded transition cursor-pointer",children:"إغلاق"})})]})},"Add-Case-Modal")]}):null},le=()=>{const[m,k]=r.useState([]),[n,E]=r.useState(0),[D,l]=r.useState(!1),[b,h]=r.useState(!1),[w,j]=r.useState(!1),[I,g]=r.useState(!1),[L,p]=r.useState(!1),[v,x]=K(),i="http://localhost:5000/api/v1/doctor",u=parseInt(v.get("page"))||1,N=6,C=v.get("search")||"",f=async()=>{l(!0);try{const o=await A.get(`${i}?page=${u}&size=${N}&search=${C}`,{withCredentials:!0});k(o.data.doctors||[]),E(o.data.totalDoctors||0)}catch(o){console.error("Failed to fetch doctors:",o)}finally{l(!1)}},B=async o=>{var d,t;h(!0);try{const s=await A.post(i,o,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}});return await f(),{success:!0,message:s.data.message}}catch(s){return{success:!1,message:((t=(d=s.response)==null?void 0:d.data)==null?void 0:t.message)||"خطأ أثناء الإضافة"}}finally{h(!1)}},U=async(o,d)=>{var t,s;j(!0);try{const c=await A.put(`${i}/${o}`,d,{withCredentials:!0});return await f(),{success:!0,message:c.data.message}}catch(c){return{success:!1,message:((s=(t=c.response)==null?void 0:t.data)==null?void 0:s.message)||"خطأ أثناء التعديل"}}finally{j(!1)}},z=async(o,d)=>{var t,s;try{const c=await A.put(`${i}/cases/${o}`,d,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}});return await f(),{success:!0,message:c.data.message}}catch(c){return{success:!1,message:((s=(t=c.response)==null?void 0:t.data)==null?void 0:s.message)||"فشل في إضافة الحالة"}}},M=async(o,d)=>{var t,s;try{const c=await A.delete(`${i}/cases/${o}`,{data:{caseId:d},withCredentials:!0});return await f(),{success:!0,message:c.data.message}}catch(c){return{success:!1,message:((s=(t=c.response)==null?void 0:t.data)==null?void 0:s.message)||"فشل في حذف الحالة"}}},P=async(o,d)=>{var t,s;p(!0);try{const c=await A.put(`${i}/image/${o}`,d,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}});return await f(),{success:!0,message:c.data.message}}catch(c){return{success:!1,message:((s=(t=c.response)==null?void 0:t.data)==null?void 0:s.message)||"فشل تحديث الصورة"}}finally{p(!1)}},_=async o=>{var d,t;g(!0);try{const s=await A.delete(`${i}/${o}`,{withCredentials:!0});return await f(),{success:!0,message:s.data.message}}catch(s){return{success:!1,message:((t=(d=s.response)==null?void 0:d.data)==null?void 0:t.message)||"فشل في الحذف"}}finally{g(!1)}};r.useEffect(()=>{f()},[u,N,C]);const $=o=>{x({page:o.toString(),search:C})};return{doctors:m,total:n,page:u,size:N,totalPages:Math.ceil(n/N),loading:D,addLoading:b,editLoading:w,deleteLoading:I,imageUploadLoading:L,addDoctor:B,updateDoctor:U,updateDoctorImage:P,deleteDoctor:_,handlePageChange:$,addCaseToDoctor:z,deleteDoctorCase:M}},be=()=>{const[m,k]=K(),{doctors:n,total:E,loading:D,page:l,totalPages:b,handlePageChange:h,addDoctor:w,updateDoctor:j,deleteDoctor:I,updateDoctorImage:g,addCaseToDoctor:L,deleteDoctorCase:p}=le(),v=m.get("search")||"",[x,i]=r.useState(v),[u,N]=r.useState(!1),[C,f]=r.useState(!1),[B,U]=r.useState(!1),[z,M]=r.useState(null),[P,_]=r.useState(null),[$,o]=r.useState(!1),d=a=>{M(a),o(!0)},t=a=>{M(a),f(!0)},s=a=>{M(a),U(!0)},c=async a=>{if((await V.fire({title:"هل أنت متأكد؟",text:"!لن تتمكن من التراجع عن هذا",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"!نعم، احذف",cancelButtonText:"إلغاء"})).isConfirmed){_(a);try{const S=await I(a);S.success?y.success(S.message):y.error(S.message)}catch(S){y.error(S.message||"حدث خطأ أثناء الحذف")}finally{_(null)}}},X=a=>{i(a),k(R=>{const S=new URLSearchParams(R);return a?(S.set("search",a),S.set("page","1")):S.delete("search"),S})};return r.useEffect(()=>{i(m.get("search")||"")},[m]),e.jsx("div",{className:"p-4 sm:p-6 bg-gray-100 min-h-screen overflow-x-auto",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-auto sm:max-w-md",dir:"rtl",children:[e.jsx(Y,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",value:x,onChange:a=>X(a.target.value),placeholder:"ابحث عن طبيب...",className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none text-right"})]}),e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 w-full sm:w-auto transition cursor-pointer",children:[e.jsx(ee,{size:20}),"إضافة طبيب جديد"]})]}),e.jsx(G,{isOpen:u,onClose:()=>N(!1),addDoctor:w}),e.jsx(J,{isOpen:C,onClose:()=>f(!1),doctor:z,updateDoctor:j}),e.jsx(ne,{isOpen:B,onClose:()=>U(!1),doctor:z,updateDoctorImage:g}),e.jsx(ie,{isOpen:$,onClose:()=>o(!1),doctor:z,addCase:L,deleteCase:p}),D?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(T,{className:"animate-spin text-blue-500",size:32})}):e.jsxs(Z.Fragment,{children:[e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-right",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"الصورة"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"الاسم"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"التخصص"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"الوصف"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.length>0?n.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("img",{src:a.image.url,alt:a.name,className:"w-10 h-10 rounded-full object-cover mx-auto cursor-pointer",onClick:()=>s(a)})}),e.jsx("td",{className:"px-4 py-3 truncate max-w-[150px]",children:a.name}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:a.specialization}),e.jsx("td",{className:"px-4 py-3 text-gray-600 max-w-xs truncate",title:Array.isArray(a.description)?a.description.join(", "):a.description,children:Array.isArray(a.description)?a.description.join(", "):a.description}),e.jsxs("td",{className:"px-4 py-3 flex gap-4 justify-center",children:[e.jsx("button",{onClick:()=>t(a),className:"text-blue-600 hover:text-blue-800 cursor-pointer mt-2",title:"تعديل",children:e.jsx(te,{size:16})}),e.jsx("button",{onClick:()=>d(a),className:"text-green-600 hover:text-green-800 cursor-pointer mt-2",title:"إدارة الحالات",children:e.jsx("span",{children:e.jsx(re,{size:18})})}),e.jsx("button",{onClick:()=>c(a._id),className:"text-red-600 hover:text-red-800 cursor-pointer mt-2",title:"حذف",disabled:P===a._id,children:P===a._id?e.jsx(T,{size:16,className:"animate-spin"}):e.jsx(se,{size:16})})]})]},a._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"py-6 text-center text-sm text-gray-500",children:"لا يوجد أطباء حاليا"})})})]})}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row justify-between items-center gap-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["عرض ",n.length," من ",E," طبيب"]}),e.jsxs("div",{className:"flex items-center gap-2 space-x-reverse",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["صفحة ",l," من ",b]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>h(l-1),disabled:l===1,className:"p-2 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50",children:e.jsx(H,{size:20})}),e.jsx("button",{onClick:()=>h(l+1),disabled:l===b,className:"p-2 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50",children:e.jsx(F,{size:20})})]})]})]})]})]})})};export{be as default};
