import{r as d,a as b,l as j,u as P,j as e}from"./index-DJ4Ad8or.js";import{u as g,y as w,L as y,E as x,c as v,a as h,b as N}from"./ReactToastify-qDOTlhbK.js";import{E as f}from"./eye-JKfjXpdK.js";const S=()=>{const[i,a]=d.useState(!1),[c,o]=d.useState(null);return{resetPassword:async(n,u)=>{var t,l;try{return a(!0),o(null),(await b.post(`http://backend-rosesmile-env.eba-xuipmsst.eu-north-1.elasticbeanstalk.com/api/v1/auth/reset/${n}`,u)).data}catch(s){return o(((l=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:l.message)||"حدث خطأ أثناء العملية"),null}finally{a(!1)}},loading:i,error:c}},C=v({password:h().matches(/^(?=.*[a-zA-Z])(?=.*[0-9]).{8,}$/,"كلمة المرور يجب أن تحتوي على أحرف وأرقام و8 أحرف على الأقل").min(8,"كلمة المرور يجب أن تكون 8 أحرف على الأقل").max(44,"كلمة المرور يجب ألا تتجاوز 44 حرفًا").required("كلمة المرور مطلوبة"),confirmPassword:h().oneOf([N("password"),null],"كلمتا المرور غير متطابقتين").required("تأكيد كلمة المرور مطلوب")}),z=()=>{const{token:i}=j(),a=P(),{resetPassword:c,loading:o,error:r}=S(),[n,u]=d.useState(!1),[t,l]=d.useState(!1),s=g({initialValues:{password:"",confirmPassword:""},validationSchema:C,onSubmit:async p=>{const m=await c(i,{newPassword:p.password,confirmPassword:p.confirmPassword});m!=null&&m.message&&(w.success(" تم تعيين كلمة المرور بنجاح"),setTimeout(()=>a("/login"),2e3))}});return d.useEffect(()=>{r!=null&&r.toLowerCase().includes("token")&&(w.error("الرابط غير صالح أو منتهي الصلاحية"),setTimeout(()=>a("/login"),3e3))},[r,a]),e.jsxs("div",{className:"min-h-screen max-w-md mx-auto px-4 py-12 text-right",dir:"rtl",children:[e.jsx(y,{position:"bottom-left",rtl:!0,theme:"colored"}),e.jsx("h2",{className:"text-3xl font-bold text-blue-800 mb-6",children:"إعادة تعيين كلمة المرور"}),r&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 text-sm",children:["⚠️ ",r]}),e.jsxs("form",{onSubmit:s.handleSubmit,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{name:"password",type:n?"text":"password",placeholder:"كلمة المرور الجديدة",className:`w-full p-3 border rounded pr-10 ${s.touched.password&&s.errors.password?"border-red-500":"border-blue-800"}`,value:s.values.password,onChange:s.handleChange,onBlur:s.handleBlur}),e.jsx("button",{type:"button",onClick:()=>u(!n),className:"absolute left-3 top-3 text-gray-600",children:n?e.jsx(x,{size:18}):e.jsx(f,{size:18})})]}),s.touched.password&&s.errors.password&&e.jsx("p",{className:"text-red-500 text-sm",children:s.errors.password}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{name:"confirmPassword",type:t?"text":"password",placeholder:"تأكيد كلمة المرور",className:`w-full p-3 border rounded pr-10 ${s.touched.confirmPassword&&s.errors.confirmPassword?"border-red-500":"border-blue-800"}`,value:s.values.confirmPassword,onChange:s.handleChange,onBlur:s.handleBlur}),e.jsx("button",{type:"button",onClick:()=>l(!t),className:"absolute left-3 top-3 text-gray-600",children:t?e.jsx(x,{size:18}):e.jsx(f,{size:18})})]}),s.touched.confirmPassword&&s.errors.confirmPassword&&e.jsx("p",{className:"text-red-500 text-sm",children:s.errors.confirmPassword}),e.jsx("button",{type:"submit",disabled:o,className:"w-full p-3 bg-blue-800 text-white rounded hover:bg-blue-900 transition",children:o?"جارٍ التحديث...":"تعيين كلمة المرور"})]})]})};export{z as default};
