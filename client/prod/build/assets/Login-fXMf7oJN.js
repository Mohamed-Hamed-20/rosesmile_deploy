import{r as c,a as f,j as t,u as y,b as w}from"./index-DJ4Ad8or.js";import{y as b,u as j,L as S,E as v,c as k,a as g}from"./ReactToastify-qDOTlhbK.js";import{E as C}from"./eye-JKfjXpdK.js";const N=()=>{const[l,a]=c.useState(!1),[d,o]=c.useState(null);return{login:async n=>{var i,p;try{a(!0),o(null);const e=await f.post("http://backend-rosesmile-env.eba-xuipmsst.eu-north-1.elasticbeanstalk.com/api/v1/auth/login",n,{withCredentials:!0});return e.data.success&&(localStorage.setItem("user",JSON.stringify(e.data.user)),localStorage.setItem("isLogin","true")),e.data}catch(e){return o(((p=(i=e==null?void 0:e.response)==null?void 0:i.data)==null?void 0:p.message)||"فشل في تسجيل الدخول"),null}finally{a(!1)}},loading:l,error:d}},L=()=>{const[l,a]=c.useState(!1),[d,o]=c.useState(null),[x,n]=c.useState(!1);return{sendResetLink:async e=>{var m,u,s;try{a(!0),o(null),n(!1);const r=await f.post("http://backend-rosesmile-env.eba-xuipmsst.eu-north-1.elasticbeanstalk.com/api/v1/auth/sendCode",{email:e});if((m=r==null?void 0:r.data)!=null&&m.message)return n(!0),{success:!0}}catch(r){const h=((s=(u=r==null?void 0:r.response)==null?void 0:u.data)==null?void 0:s.message)||"فشل في إرسال الرابط";return o(h),{error:h}}finally{a(!1)}},loading:l,error:d,success:x,resetState:()=>{o(null),n(!1)}}},R=({isOpen:l,onClose:a})=>{const[d,o]=c.useState(""),{sendResetLink:x,loading:n,error:i,success:p,resetState:e}=L(),m=async u=>{u.preventDefault();const s=await x(d.trim());s!=null&&s.success&&(b.success("تم إرسال رابط إعادة التعيين إلى بريدك الإلكتروني"),setTimeout(()=>{o(""),a(),e()},3e3)),s!=null&&s.error&&b.error(s.error)};return c.useEffect(()=>{l||(o(""),e())},[l,e]),l?t.jsx("div",{style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.2)",backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)"},children:t.jsxs("div",{style:{backgroundColor:"#ffffff",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0,0,0,0.15)",padding:"24px",width:"100%",maxWidth:"450px",textAlign:"right",direction:"rtl"},children:[t.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"bold",marginBottom:"16px",color:"#1e40af"},children:"إعادة تعيين كلمة المرور"}),t.jsxs("form",{onSubmit:m,children:[t.jsx("input",{type:"email",placeholder:"أدخل بريدك الإلكتروني",value:d,onChange:u=>o(u.target.value),required:!0,style:{width:"100%",padding:"12px",marginBottom:"12px",border:"1px solid blue",borderRadius:"8px",fontSize:"14px"}}),i&&t.jsxs("p",{style:{backgroundColor:"#fee2e2",color:"#b91c1c",fontSize:"14px",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:["⚠️ ",i]}),p&&t.jsx("p",{style:{backgroundColor:"#dcfce7",color:"#15803d",fontSize:"14px",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:"تم إرسال الكود إلى بريدك الإلكتروني"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"16px"},children:[t.jsx("button",{type:"button",onClick:()=>{a(),e()},style:{padding:"10px 16px",backgroundColor:"#e5e7eb",borderRadius:"6px",border:"none",cursor:"pointer",fontWeight:"bold"},children:"إلغاء"}),t.jsx("button",{type:"submit",disabled:n,style:{padding:"10px 16px",backgroundColor:"#1e40af",color:"white",borderRadius:"6px",border:"none",cursor:"pointer",fontWeight:"bold"},children:n?"جارٍ الإرسال...":"إرسال الرابط"})]})]})]})}):null},E=k({email:g().email("بريد إلكتروني غير صالح").matches(/^[\w-.]+@([\w-]+\.)+(com|net|org|pro|eg|sa)$/i,"البريد الإلكتروني يجب أن ينتهي بـ com أو net أو org أو pro أو eg أو sa").required("البريد الإلكتروني مطلوب"),password:g().min(8,"كلمة المرور يجب أن تكون 8 أحرف على الأقل").matches(/^(?=.*[a-zA-Z])(?=.*[0-9]).{8,}$/,"كلمة المرور يجب أن تحتوي على أحرف وأرقام").required("كلمة المرور مطلوبة")}),F=()=>{const{login:l,loading:a,error:d}=N(),o=y(),[x,n]=c.useState(!1),[i,p]=c.useState(!1),e=j({initialValues:{email:"",password:""},validationSchema:E,onSubmit:async m=>{const u={email:m.email.trim(),password:m.password.trim()},s=await l(u);if(s!=null&&s.success){b.success("تم تسجيل الدخول بنجاح");const r=(s==null?void 0:s.user)||JSON.parse(localStorage.getItem("user"));setTimeout(()=>{(r==null?void 0:r.role)==="admin"||(r==null?void 0:r.role)==="superadmin"?o("/admin-dashboard"):o("/")},500)}}});return t.jsxs("div",{className:"min-h-screen max-w-md mx-auto px-4 py-12 text-center ",children:[t.jsx(S,{position:"bottom-left",rtl:!0,theme:"colored"}),t.jsx("h2",{className:"text-3xl font-bold text-blue-800 mb-6",children:"تسجيل الدخول"}),d&&t.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 text-sm text-right",dir:"rtl",children:["⚠️ ",d]}),t.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4 text-right",dir:"rtl",children:[t.jsx("input",{name:"email",type:"email",placeholder:"البريد الإلكتروني",className:`w-full p-3 border rounded ${e.touched.email&&e.errors.email?"border-red-500":"border-blue-800"}`,value:e.values.email,onChange:e.handleChange,onBlur:e.handleBlur}),e.touched.email&&e.errors.email&&t.jsx("div",{className:"text-red-500 text-sm",children:e.errors.email}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{name:"password",type:i?"text":"password",placeholder:"كلمة المرور",className:`w-full p-3 border rounded pr-10 ${e.touched.password&&e.errors.password?"border-red-500":"border-blue-800"}`,value:e.values.password,onChange:e.handleChange,onBlur:e.handleBlur}),t.jsx("button",{type:"button",onClick:()=>p(!i),className:"absolute left-3 top-3 text-gray-600",children:i?t.jsx(v,{size:18}):t.jsx(C,{size:18})})]}),e.touched.password&&e.errors.password&&t.jsx("div",{className:"text-red-500 text-sm",children:e.errors.password}),t.jsx("div",{className:"text-left",children:t.jsx("button",{type:"button",className:"text-blue-800 hover:underline text-sm",onClick:()=>n(!0),children:"نسيت كلمة المرور؟"})}),t.jsx("button",{type:"submit",className:"w-full p-3 bg-blue-800 text-white rounded hover:bg-blue-900 transition",disabled:a,children:a?"جاري الدخول...":"دخول"})]}),t.jsxs("p",{className:"mt-4 text-gray-600",children:["ليس لديك حساب؟"," ",t.jsx(w,{to:"/register",className:"text-blue-800 hover:underline",children:"إنشاء حساب"})]}),t.jsx(R,{isOpen:x,onClose:()=>n(!1)})]})};export{F as default};
