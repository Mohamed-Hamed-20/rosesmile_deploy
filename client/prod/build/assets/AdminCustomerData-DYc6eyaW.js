import{c as F,r as i,j as e,D as P,F as B,z as b,f as _,a as M,i as O,R,P as T,T as q,d as U,H}from"./index-DJ4Ad8or.js";import{C as V}from"./chevron-left-D4iPk7fL.js";/**
 * @license lucide-react v0.485.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"m5 19-2 2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2",key:"1xuzuj"}],["path",{d:"M9 10h6",key:"9gxzsh"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 17h6",key:"r8uit2"}]],J=F("message-square-diff",G),K=({isOpen:p,onClose:f,data:a,updateCustomerData:v})=>{const[r,o]=i.useState({name:"",phone:"",city:"",comment:"",status:""}),[n,d]=i.useState(!1);i.useEffect(()=>{a&&o({name:a.name||"",phone:a.phone||"",city:a.city||"",comment:a.comment||"",status:a.status||""})},[a]);const x=(s,u)=>{o({...r,[u]:s.target.value})},j=async s=>{s.preventDefault(),d(!0);const u={name:r.name,phone:r.phone,city:r.city,comment:r.comment,status:r.status};try{const l=await v(a._id,u);l.success?(b.success(l.message),f()):b.error(l.message||"حدث خطأ أثناء تعديل معلومات العميل")}catch(l){b.error(l.message||"حدث خطأ أثناء تعديل معلومات العميل")}finally{d(!1)}};return!p||!a?null:e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black/60 flex items-center justify-center z-500 p-4",children:e.jsxs(P.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[95vh] min-h-[40vh] overflow-y-auto flex flex-col box-border",dir:"rtl",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-800 border-b pb-4 px-8 pt-8",children:"تعديل بيانات العميل"}),e.jsxs("form",{onSubmit:j,className:"flex-grow space-y-6 px-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم العميل"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>x(s,"name"),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-right",required:!0,disabled:n})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"هاتف العميل"}),e.jsx("input",{type:"text",value:r.phone,onChange:s=>x(s,"phone"),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-right",required:!0,disabled:n})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدينة"}),e.jsx("input",{type:"text",value:r.city,onChange:s=>x(s,"city"),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-right",required:!0,disabled:n})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"تعليق"}),e.jsx("input",{type:"text",value:r.comment,onChange:s=>x(s,"comment"),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-right",disabled:n})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الحالة"}),e.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-right",value:r.status,onChange:s=>x(s,"status"),disabled:n,children:[e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"absent",children:"absent"}),e.jsx("option",{value:"completed",children:"completed"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-between items-center",children:[e.jsx("button",{type:"button",onClick:f,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition cursor-pointer",disabled:n,children:"إغلاق"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2 cursor-pointer",disabled:n,children:n?e.jsx(B,{className:"animate-spin",size:20}):"حفظ التعديلات"})]}),e.jsx("div",{className:"h-4"})]})]})},"Edit-Customer-Data-Modal")},Q=({isOpen:p,onClose:f,data:a,addComment:v})=>{const[r,o]=i.useState({comment:"",status:""}),[n,d]=i.useState(!1);i.useEffect(()=>{a&&o({comment:a.comment||"",status:a.status||""})},[a]);const x=(s,u)=>{o({...r,[u]:s.target.value})},j=async s=>{s.preventDefault(),d(!0);const u={comment:r.comment,status:r.status};try{const l=await v(a._id,u);l.success?(b.success(l.message),f()):b.error(l.message||"حدث خطأ أثناء تعديل معلومات العميل")}catch(l){b.error(l.message||"حدث خطأ أثناء تعديل معلومات العميل")}finally{d(!1)}};return!p||!a?null:e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black/60 flex items-center justify-center z-500 p-4",children:e.jsxs(P.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[95vh] min-h-[40vh] overflow-y-auto flex flex-col box-border",dir:"rtl",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-800 border-b pb-4 px-8 pt-8",children:"اضافة تعليق وتحديث حالة العميل"}),e.jsxs("form",{onSubmit:j,className:"flex-grow space-y-6 px-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"تعليق"}),e.jsx("input",{type:"text",value:r.comment,onChange:s=>x(s,"comment"),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-right",disabled:n})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الحالة"}),e.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-right",value:r.status,onChange:s=>x(s,"status"),disabled:n,children:[e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"absent",children:"absent"}),e.jsx("option",{value:"completed",children:"completed"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-between items-center",children:[e.jsx("button",{type:"button",onClick:f,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition cursor-pointer",disabled:n,children:"إغلاق"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2 cursor-pointer",disabled:n,children:n?e.jsx(B,{className:"animate-spin",size:20}):"حفظ التعديلات"})]}),e.jsx("div",{className:"h-4"})]})]})},"Edit-Customer-Data-Modal")},W=()=>{const[p,f]=i.useState([]),[a,v]=i.useState(0),[r,o]=i.useState(!1),[n,d]=i.useState(!1),[x,j]=i.useState(!1),[s,u]=_(),l="http://backend-rosesmile-env.eba-xuipmsst.eu-north-1.elasticbeanstalk.com/api/v1/form",w=parseInt(s.get("page"))||1,C=6,S=s.get("search")||"",D=async()=>{o(!0);try{const c=await M.get(`${l}?page=${w}&size=${C}&search=${S}`,{withCredentials:!0});f(c.data.forms||[]),v(c.data.totalForms||0)}catch(c){console.error("Failed to fetch forms:",c)}finally{o(!1)}},z=async(c,N)=>{var g,h;d(!0);try{const y=await M.patch(`${l}/${c}`,N,{withCredentials:!0});return await D(),{success:!0,message:y.data.message}}catch(y){return{success:!1,message:((h=(g=y.response)==null?void 0:g.data)==null?void 0:h.message)||"خطأ أثناء الإضافة"}}finally{d(!1)}},E=async(c,N)=>{var g,h;d(!0);try{const y=await M.put(`${l}/${c}`,N,{withCredentials:!0});return await D(),{success:!0,message:y.data.message}}catch(y){return{success:!1,message:((h=(g=y.response)==null?void 0:g.data)==null?void 0:h.message)||"خطأ أثناء التعديل"}}finally{d(!1)}},L=async c=>{var N,g;j(!0);try{const h=await M.delete(`${l}/${c}`,{withCredentials:!0});return await D(),{success:!0,message:h.data.message}}catch(h){return{success:!1,message:((g=(N=h.response)==null?void 0:N.data)==null?void 0:g.message)||"فشل في الحذف"}}finally{j(!1)}};i.useEffect(()=>{D()},[w,C,S]);const $=c=>{u({page:c.toString(),search:S})};return{customerData:p,total:a,page:w,size:C,totalPages:Math.ceil(a/C),loading:r,editLoading:n,deleteLoading:x,addComment:z,updateCustomerData:E,deleteCustomerData:L,handlePageChange:$}},Z=()=>{const[p,f]=_(),{customerData:a,total:v,loading:r,page:o,totalPages:n,handlePageChange:d,addComment:x,updateCustomerData:j,deleteCustomerData:s}=W(),u=p.get("search")||"",[l,w]=i.useState(u),[C,S]=i.useState(!1),[D,z]=i.useState(!1),[E,L]=i.useState(null),[$,c]=i.useState(null),N=t=>{L(t),S(!0)},g=t=>{L(t),z(!0)},h=async t=>{if((await H.fire({title:"هل أنت متأكد؟",text:"!لن تتمكن من التراجع عن هذا",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"!نعم، احذف",cancelButtonText:"إلغاء"})).isConfirmed){c(t);try{const m=await s(t);m.success?b.success(m.message):b.error(m.message)}catch(m){b.error(m.message||"حدث خطأ أثناء الحذف")}finally{c(null)}}},y=t=>{w(t),f(k=>{const m=new URLSearchParams(k);return t?(m.set("search",t),m.set("page","1")):m.delete("search"),m})};return i.useEffect(()=>{w(p.get("search")||"")},[p]),e.jsx("div",{className:"p-4 sm:p-6 bg-gray-100 min-h-screen overflow-x-auto",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{className:"relative w-full sm:w-auto sm:max-w-md",dir:"rtl",children:[e.jsx(O,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",value:l,onChange:t=>y(t.target.value),placeholder:"ابحث عن عميل...",className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none text-right"})]})}),e.jsx(K,{isOpen:C,onClose:()=>S(!1),data:E,updateCustomerData:j}),e.jsx(Q,{isOpen:D,onClose:()=>z(!1),data:E,addComment:x}),r?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(B,{className:"animate-spin text-blue-500",size:32})}):e.jsxs(R.Fragment,{children:[e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-right",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"اسم العميل"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"رقم هاتف العميل"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"المدينة"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"القسم"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"الخدمة"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"الحالة"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"تعليق"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"تم التعديل بواسطة"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"اخر تحديث"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.length>0?a.map(t=>{var k,m,A,I;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-center",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.phone}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.city}),e.jsx("td",{className:"px-4 py-3 text-center",children:(k=t==null?void 0:t.section)==null?void 0:k.title}),e.jsx("td",{className:"px-4 py-3 text-center",children:(m=t==null?void 0:t.service)==null?void 0:m.title}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.status}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.comment?`${t.comment}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.editedBy?`${(A=t.editedBy)==null?void 0:A.firstName} ${(I=t.editedBy)==null?void 0:I.lastName}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:new Date(t.updatedAt).toLocaleString("ar-Ar",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsxs("td",{className:"px-4 py-3 flex flex-row gap-4 justify-center items-center",children:[e.jsx("button",{onClick:()=>g(t),className:"text-blue-600 hover:text-blue-800 cursor-pointer mt-2",title:"اضافة تعليق",children:e.jsx(J,{size:16})}),e.jsx("button",{onClick:()=>N(t),className:"text-blue-600 hover:text-blue-800 cursor-pointer mt-2",title:"تعديل",children:e.jsx(T,{size:16})}),e.jsx("button",{onClick:()=>h(t._id),className:"text-red-600 hover:text-red-800 cursor-pointer mt-2",title:"حذف",disabled:$===t._id,children:$===t._id?e.jsx(B,{size:16,className:"animate-spin"}):e.jsx(q,{size:16})})]})]},t._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"py-6 text-center text-sm text-gray-500",children:"لا يوجد بيانات عملاء حاليا"})})})]})}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row justify-between items-center gap-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["عرض ",a.length," من ",v," عميل"]}),e.jsxs("div",{className:"flex items-center gap-2 space-x-reverse",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["صفحة ",o," من ",n]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>d(o-1),disabled:o===1,className:"p-2 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50",children:e.jsx(V,{size:20})}),e.jsx("button",{onClick:()=>d(o+1),disabled:o===n,className:"p-2 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50",children:e.jsx(U,{size:20})})]})]})]})]})]})})};export{Z as default};
