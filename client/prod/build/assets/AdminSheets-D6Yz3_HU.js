import{c as A,r as s,j as e,D as z,F as E,z as p,f as O,a as U,i as B,K as F,R as T,P as q,T as H,d as K,H as G}from"./index-DJ4Ad8or.js";import{C as J}from"./chevron-left-D4iPk7fL.js";/**
 * @license lucide-react v0.485.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],V=A("link",Q),W=({isOpen:f,onClose:v,addSheet:r})=>{const[d,c]=s.useState({title:"",url:"",image:null}),[i,o]=s.useState(null),[l,g]=s.useState(!1),j=(a,n)=>{c({...d,[n]:a.target.value})},m=a=>{const n=a.target.files[0];n&&(o(URL.createObjectURL(n)),c({...d,image:n}))},b=async a=>{if(a.preventDefault(),!d.image){p.error("يرجى اختيار صورة الفورم");return}g(!0);const n=new FormData;n.append("title",d.title),n.append("url",d.url),n.append("image",d.image);try{const h=await r(n);h.success?(p.success(h.message),v(),c({title:"",url:"",image:null}),o(null)):p.error(h.message||"حدث خطأ أثناء إضافة الفورم")}catch(h){p.error(h.message||"حدث خطأ أثناء إضافة الفورم")}finally{g(!1)}};return f?e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black/60 flex items-center justify-center z-500 p-4",children:e.jsxs(z.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl min-h-[60vh] max-h-[65vh] overflow-y-auto p-8 md:p-10",dir:"rtl",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-800 border-b pb-4",children:"إضافة فورم جديد"}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"flex items-center justify-between my-10",children:[e.jsxs("div",{className:"flex flex-col w-1/2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الفورم"}),e.jsx("input",{type:"text",value:d.title,onChange:a=>j(a,"title"),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-right mt-2 transition-all duration-200",required:!0,disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 mt-11",children:"عنوان الفورم المميز"}),e.jsx("input",{type:"text",value:d.url,onChange:a=>j(a,"url"),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-right mt-2 transition-all duration-200",required:!0,disabled:l})]})]}),e.jsx("div",{className:"flex justify-center items-start",children:e.jsxs("div",{className:"relative h-50 w-90 border-2 border-dashed border-gray-300 hover:bg-gray-100 overflow-hidden rounded-md cursor-pointer hover:opacity-90 transition",onClick:()=>document.getElementById("imageUpload").click(),children:[i?e.jsx("img",{src:i,alt:"Preview",className:"w-full h-full object-cover object-top"}):e.jsx("span",{className:"flex items-center justify-center h-full text-gray-400 text-sm text-center px-2",children:"اضغط لرفع صورة"}),e.jsx("input",{type:"file",id:"imageUpload",onChange:m,className:"hidden",accept:"image/*",disabled:l})]})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("button",{type:"button",onClick:v,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition cursor-pointer",disabled:l,children:"إغلاق"}),e.jsx("button",{type:"button",onClick:()=>{c({title:"",url:"",image:null}),o(null)},className:"px-6 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition cursor-pointer",disabled:l,children:"إعادة ضبط"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2 cursor-pointer",disabled:l,children:l?e.jsx(E,{className:"animate-spin",size:20}):"تاكيد الإضافة"})]})]})]})},"Add-Sheet-Modal"):null},X=({isOpen:f,onClose:v,sheet:r,updateSheet:d})=>{const[c,i]=s.useState({title:"",url:""}),[o,l]=s.useState(!1);s.useEffect(()=>{r&&i({title:r.title||"",url:r.url||""})},[r]);const g=(m,b)=>{i({...c,[b]:m.target.value})},j=async m=>{m.preventDefault(),l(!0);const b={title:c.title,url:c.url};try{const a=await d(r._id,b);a.success?(p.success(a.message),v()):p.error(a.message||"حدث خطأ أثناء تعديل الفورم")}catch(a){p.error(a.message||"حدث خطأ أثناء تعديل الفورم")}finally{l(!1)}};return!f||!r?null:e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs(z.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[95vh] min-h-[40vh] overflow-y-auto flex flex-col box-border",dir:"rtl",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-800 border-b pb-4 px-8 pt-8",children:"تعديل بيانات الفورم"}),e.jsxs("form",{onSubmit:j,className:"flex-grow space-y-6 px-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الفورم"}),e.jsx("input",{type:"text",value:c.title,onChange:m=>g(m,"title"),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-right",required:!0,disabled:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"عنوان الفورم المميز"}),e.jsx("input",{type:"text",value:c.url,onChange:m=>g(m,"url"),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-right",required:!0,disabled:o})]}),e.jsxs("div",{className:"mt-6 flex justify-between items-center",children:[e.jsx("button",{type:"button",onClick:v,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition cursor-pointer",disabled:o,children:"إغلاق"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2 cursor-pointer",disabled:o,children:o?e.jsx(E,{className:"animate-spin",size:20}):"حفظ التعديلات"})]}),e.jsx("div",{className:"h-4"})]})]})},"Edit-Sheet-Modal")},Y=({isOpen:f,onClose:v,sheet:r,updateSheetImage:d})=>{var n,h;const[c,i]=s.useState(null),[o,l]=s.useState(null),[g,j]=s.useState(!1);s.useEffect(()=>{f||(i(null),l(null))},[f]);const m=I=>{const x=I.target.files[0];x&&(l(URL.createObjectURL(x)),i(x))},b=()=>{i(null),l(null),v()},a=async I=>{if(I.preventDefault(),!c){p.error("يرجى اختيار صورة للتحديث");return}j(!0);const x=new FormData;x.append("image",c);try{const w=await d(r._id,x);w.success?(p.success(w.message),b()):p.error(w.message||"فشل تحديث صورة الفورم")}catch(w){p.error(w.message||"حدث خطأ أثناء تحديث الصورة")}finally{j(!1)}};return!f||!r?null:e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black/60 flex items-center justify-center z-500 p-4",children:e.jsxs(z.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.3},className:"bg-white rounded-xl shadow-2xl w-full max-w-xl p-8 ",dir:"rtl",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800 text-right border-b pb-3",children:"تحديث صورة الفورم"}),e.jsxs("form",{onSubmit:a,children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:"relative aspect h-100 bg-gray-100 overflow-hidden rounded-xl shadow-md cursor-pointer hover:opacity-90 transition",onClick:()=>document.getElementById("sheetImageUpload").click(),children:[o||(n=r.image)!=null&&n.url?e.jsx("img",{src:o||((h=r.image)==null?void 0:h.url),alt:"Preview",className:"w-full h-full object-cover object-top"}):e.jsx("span",{className:"flex items-center justify-center text-gray-400 text-sm text-center px-2",children:"اضغط لرفع صورة"}),e.jsx("input",{type:"file",id:"sheetImageUpload",onChange:m,className:"hidden",accept:"image/*",disabled:g})]})}),e.jsxs("div",{className:"flex justify-between items-center gap-2 mt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition cursor-pointer",disabled:g,children:"اغلاق"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2 cursor-pointer",disabled:g,children:g?e.jsx(E,{className:"animate-spin",size:20}):"تحديث الصورة"})]})]})]})},"Update-Sheet-Image-Modal")},Z=()=>{const[f,v]=s.useState([]),[r,d]=s.useState(0),[c,i]=s.useState(!1),[o,l]=s.useState(!1),[g,j]=s.useState(!1),[m,b]=s.useState(!1),[a,n]=s.useState(!1),[h,I]=O(),x="http://backend-rosesmile-env.eba-xuipmsst.eu-north-1.elasticbeanstalk.com/api/v1/sheet",w=parseInt(h.get("page"))||1,L=6,P=h.get("search")||"",k=async()=>{i(!0);try{const u=await U.get(`${x}?page=${w}&size=${L}&search=${P}`,{withCredentials:!0});v(u.data.sheets||[]),d(u.data.totalSheets||0)}catch(u){console.error("Failed to fetch sheets:",u)}finally{i(!1)}},M=async u=>{var N,y;l(!0);try{const t=await U.post(x,u,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}});return await k(),{success:!0,message:t.data.message}}catch(t){return{success:!1,message:((y=(N=t.response)==null?void 0:N.data)==null?void 0:y.message)||"خطأ أثناء الإضافة"}}finally{l(!1)}},D=async(u,N)=>{var y,t;j(!0);try{const S=await U.put(`${x}/${u}`,N,{withCredentials:!0});return await k(),{success:!0,message:S.data.message}}catch(S){return{success:!1,message:((t=(y=S.response)==null?void 0:y.data)==null?void 0:t.message)||"خطأ أثناء التعديل"}}finally{j(!1)}},_=async(u,N)=>{var y,t;n(!0);try{const S=await U.put(`${x}/image/${u}`,N,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}});return await k(),{success:!0,message:S.data.message}}catch(S){return{success:!1,message:((t=(y=S.response)==null?void 0:y.data)==null?void 0:t.message)||"فشل تحديث الصورة"}}finally{n(!1)}},$=async u=>{var N,y;b(!0);try{const t=await U.delete(`${x}/${u}`,{withCredentials:!0});return await k(),{success:!0,message:t.data.message}}catch(t){return{success:!1,message:((y=(N=t.response)==null?void 0:N.data)==null?void 0:y.message)||"فشل في الحذف"}}finally{b(!1)}};s.useEffect(()=>{k()},[w,L,P]);const R=u=>{I({page:u.toString(),search:P})};return{sheets:f,total:r,page:w,size:L,totalPages:Math.ceil(r/L),loading:c,addLoading:o,editLoading:g,deleteLoading:m,imageUploadLoading:a,addSheet:M,updateSheet:D,updateSheetImage:_,deleteSheet:$,handlePageChange:R}},se=()=>{const[f,v]=O(),{sheets:r,total:d,loading:c,page:i,totalPages:o,handlePageChange:l,addSheet:g,updateSheet:j,deleteSheet:m,updateSheetImage:b}=Z(),a=f.get("search")||"",[n,h]=s.useState(a),[I,x]=s.useState(!1),[w,L]=s.useState(!1),[P,k]=s.useState(!1),[M,D]=s.useState(null),[_,$]=s.useState(null),R=t=>{D(t),L(!0)},u=t=>{D(t),k(!0)},N=async t=>{if((await G.fire({title:"هل أنت متأكد؟",text:"!لن تتمكن من التراجع عن هذا",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"!نعم، احذف",cancelButtonText:"إلغاء"})).isConfirmed){$(t);try{const C=await m(t);C.success?p.success(C.message):p.error(C.message)}catch(C){p.error(C.message||"حدث خطأ أثناء الحذف")}finally{$(null)}}},y=t=>{h(t),v(S=>{const C=new URLSearchParams(S);return t?(C.set("search",t),C.set("page","1")):C.delete("search"),C})};return s.useEffect(()=>{h(f.get("search")||"")},[f]),e.jsx("div",{className:"p-4 sm:p-6 bg-gray-100 min-h-screen overflow-x-auto",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-auto sm:max-w-md",dir:"rtl",children:[e.jsx(B,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",value:n,onChange:t=>y(t.target.value),placeholder:"ابحث عن فورم...",className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none text-right"})]}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 w-full sm:w-auto transition cursor-pointer",children:[e.jsx(F,{size:20}),"إضافة فورم جديدة"]})]}),e.jsx(W,{isOpen:I,onClose:()=>x(!1),addSheet:g}),e.jsx(X,{isOpen:w,onClose:()=>L(!1),sheet:M,updateSheet:j}),e.jsx(Y,{isOpen:P,onClose:()=>k(!1),sheet:M,updateSheetImage:b}),c?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(E,{className:"animate-spin text-blue-500",size:32})}):e.jsxs(T.Fragment,{children:[e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-right",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"صورة الفورم"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"اسم الفورم"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"لينك الفورم"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"عنوان الفورم المميز"}),e.jsx("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.length>0?r.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("img",{src:t.image.url,alt:t.title,className:"w-10 h-10 rounded-full object-cover mx-auto cursor-pointer",onClick:()=>u(t)})}),e.jsx("td",{className:"px-4 py-3 truncate max-w-[150px] text-center",children:t.title}),e.jsx("td",{className:"px-4 py-3 text-gray-600 flex gap-2 justify-center",children:e.jsxs("a",{href:t.sheet_weblink,target:"_blank",className:"flex items-center gap-2",children:[t.sheet_id,e.jsx(V,{size:16})]})}),e.jsx("td",{className:"px-4 py-3 text-gray-600 max-w-xs truncate text-center",title:t.url,children:t.url}),e.jsxs("td",{className:"px-4 py-3 flex gap-4 justify-center",children:[e.jsx("button",{onClick:()=>R(t),className:"text-blue-600 hover:text-blue-800 cursor-pointer mt-2",title:"تعديل",children:e.jsx(q,{size:16})}),e.jsx("button",{onClick:()=>N(t._id),className:"text-red-600 hover:text-red-800 cursor-pointer mt-2",title:"حذف",disabled:_===t._id,children:_===t._id?e.jsx(E,{size:16,className:"animate-spin"}):e.jsx(H,{size:16})})]})]},t._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"py-6 text-center text-sm text-gray-500",children:"لا يوجد فورمات حاليا"})})})]})}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row justify-between items-center gap-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["عرض ",r.length," من ",d," فورم"]}),e.jsxs("div",{className:"flex items-center gap-2 space-x-reverse",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["صفحة ",i," من ",o]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l(i-1),disabled:i===1,className:"p-2 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50",children:e.jsx(J,{size:20})}),e.jsx("button",{onClick:()=>l(i+1),disabled:i===o,className:"p-2 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50",children:e.jsx(K,{size:20})})]})]})]})]})]})})};export{se as default};
